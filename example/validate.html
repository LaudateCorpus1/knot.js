<!doctype html>
<html>
<head>
    <link rel="stylesheet" href="styles/example.css">

    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>

    <link rel="stylesheet" href="./styles/github.css">
    <script src="js/highlight.pack.js"></script>

    <link rel="stylesheet" href="styles/tabpage.css">
    <script type="text/cbs" src="cbs/tabpage.cbs"></script>
    <script type="text/cbs" src="cbs/sourceTab.cbs"></script>

    <!--<script src="../src/core/PrivateScope.js"></script>-->
    <!--<script src="../src/core/Utility.js"></script>-->
    <!--<script src="../src/core/Deferred.js"></script>-->
    <!--<script src="../src/core/AttachedData.js"></script>-->
    <!--<script src="../src/core/DataObserver.js"></script>-->
    <!--<script src="../src/core/ArrayMonitor.js"></script>-->
    <!--<script src="../src/core/GlobalSymbolHelper.js"></script>-->
    <!--<script src="../src/core/OptionParser.js"></script>-->
    <!--<script src="../src/core/AccessPointManager.js"></script>-->
    <!--<script src="../src/core/HTMLAPProvider.js"></script>-->
    <!--<script src="../src/core/HTMLKnotManager.js"></script>-->
    <!--<script src="../src/addon/AddonHTMLAPProvider.js"></script>-->
    <!--<script src="../src/core/KnotInterface.js"></script>-->

    <script src="../release/knot.all.min.js"></script>

    <script src="../src/debugger/knot.debug.js"></script>

    <style type="text/css" id="exampleCSS">
    .section{
        margin: 5px;
    }
    .errMessage{
        color:red;
    }
    .errorInput {
        box-shadow: 0px 0px 5px red;
    }
    </style>

    <script type="text/cbs"  class="exampleCBS">
    form input[type=text]{
        class: !*LEFT.value>@{return value?"+errorInput":"-errorInput";}
    }

    #nameSection input{
        value> @/validator.notEmpty> {
                if(value.length < 3)
                    throw new Error("Name must be more than 3 characters");
                if(value.length > 10)
                    throw new Error("Name must be no more than 10 characters");
                return value;
            }: *NULL;
    }

    #nameSection .errMessage{
        textContent:!#(#nameSection input).value>{return value?value.message:"";}
    }


    #ageSection input{
        value> @/validator.notEmpty> @/validator.checkAndConvertToNumber> @validator.checkAgeRange : *NULL;
    }
    #ageSection .errMessage{
        textContent:!#(#ageSection input).value>{return value?value.message:"";}
    }

     #emailSection input{
        value>@/validator.notEmpty> {
            if(!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(value))
                throw new Error("Invalid email!");
            return value;
        }:*NULL;
    }
    #emailSection .errMessage{
        textContent:!#(#emailSection input).value>{return value?value.message:"";}
    }
    </script>
    <script class="exampleJS">
        window.validator ={
            notEmpty:function(v){
                if(v.trim() == "")
                    throw new Error("Can't be null.")
                return v;
            },
            checkAndConvertToNumber:function(v){
                v = parseInt(v);
                if(isNaN(v))
                    throw new Error("Age must be a number!");
                return v;
            },
            checkAgeRange:function(v){
                if(v<0 || v>150){
                    throw new Error("Age must be in the range of 0~150")
                }
                return v;
            }
        };

        function validate(){
            var err = Knot.getErrorStatusInformation();
            if(err.length > 0){
                var msg = "Error detected:";
                for(var i=0; i< err.length; i++){
                    msg += "\n - " + err[i].node.placeholder  + ": " + err[i].error.message;
                }
                alert(msg);
                err[0].node.focus();
                return false;
            }
            alert("Let's fake it committed !");
            return true;
        }
    </script>
</head>
<body>
<div class="knot_example">
    <h2>Knot.js example - input validate</h2>
    <form action="" onsubmit="return validate();">
        <div class="section" id="nameSection">
            <input type="text" placeholder="Name">  <span class="errMessage"></span>
        </div>
        <div class="section" id="ageSection">
            <input type="text" placeholder="Age">  <span class="errMessage"></span>
        </div>
        <div class="section" id="emailSection">
            <input type="text" placeholder="Email">  <span class="errMessage"></span>
        </div>

        <input type="submit">
    </form>
</div>

<script src="js/tabpage.js"></script>
<script type="text/javascript" src="js/sourceTab.js"></script>

</body>
</html>