(function(h){var f={Setting:{enablePropertyHook:!0},Log:{Level:{Info:"Info",Warning:"Warning",Error:"Error"},log:function(d,b,a){console.log("["+d+"]"+b);a&&console.log(a)},info:function(d,b){this.log(this.Level.Info,d,b)},warning:function(d,b){this.log(this.Level.Warning,d,b)},error:function(d,b){this.log(this.Level.Error,d,b)}},Debugger:{knotChanged:function(){},knotTied:function(){},knotUntied:function(){},nodeAdded:function(){},nodeRemoved:function(){}}};h.Knot={K1M:function(){return f}}})(function(){return this}());(function(h){var f=h.Knot.K1M();f.K1F={K1H:function(d){for(var b in d)return!1;return!0},trim:function(d){return d.trim?d.trim():d.replace(/^\s+|\s+$/g,"")},K1G:function(d,b){return!d?!1:d.substr(0,b.length)==b},getValueOnPath:function(d,b){if(b||""===b){if("*NULL"==b)return null;if("*"==b||""==b)return d;var a=!1;"@"==b[0]&&(a=!0,b=b.substr(1));var c;if(this.K1G(b,"__knot_global"))c=f.KS.KV(b);else{var g=d;"/"==b[0]&&(g=h,b=b.substr(1));
for(;0<=b.indexOf(".")&&g;)var e=f.K1F.trim(b.substr(0,b.indexOf("."))),g="*"!=e?g[e]:void 0,b=f.K1F.trim(b.substr(b.indexOf(".")+1));"*"==b?c=g:g&&(c=g[b])}if(a&&c&&"function"!=typeof c)f.Log.error("'"+b+"' is expected as a function, but it isn't.");else return c}},setValueOnPath:function(d,b,a){if("*"!=b[b.length-1]){if(this.K1G(b,"__knot_global"))throw Error("Can't set global symbol!");b&&"/"==b[0]&&(d=h,b=b.substr(1));var c=b,g=b.lastIndexOf(".");0<g&&(c=b.substr(g+1),d=this.getValueOnPath(d,
b.substr(0,g)));d&&(d[c]=a)}},K1I:function(){return h.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},K1J:function(d,b,a,c){var g={start:-1,end:-1};g.start=d.indexOf(a,b);if(0>g.start)return null;for(var b=0,e=g.start+1;;){var i=d.indexOf(a,e),e=d.indexOf(c,e);if(0>e)break;if(0>i||e<i){if(0==b){g.end=e;break}else b--;e+=1}else b++,e=i+1}return 0<=g.start&&0<=g.end?g:null},Kc:function(d){var b=this.K1J(d,0,"[","]");if(!b){d=d.substr(b.start+
1,b.end-b.start-1);d=d.split(",");for(b=0;b<d.length;b++);}},K1K:function(d,b){var a=0;prev=0;for(var c=[],g=0,e=0;a<d.length;){switch(d[a]){case "(":g++;break;case ")":g=Math.max(0,g-1);break;case "[":e++;break;case "]":e=Math.max(0,e-1);break;case b:0==g&&0==e&&(c.push(d.substr(prev,a-prev)),prev=a+1)}a++}a>=prev&&c.push(d.substr(prev,a-prev));return c}}})(function(){return this}());(function(h){h=h.Knot.K1M();h.Deferred=function(){this._succCallbacks=[];this._errCallbacks=[];this.isRejected=this.isFinished=!1;this.result=null};h.Deferred.prototype.resolve=function(f){this.result=f;this.isFinished=!0;this.isRejected=!1;for(var d=0;d<this._succCallbacks.length;d++)this._succCallbacks[d](f)};h.Deferred.prototype.reject=function(f){this.result=f;this.isRejected=this.isFinished=!0;for(var d=0;d<this._errCallbacks.length;d++)this._errCallbacks[d](f)};h.Deferred.prototype.done=
function(f,d){this.isFinished?this.isRejected?d(this.result):f(this.result):(this._succCallbacks.push(f),this._errCallbacks.push(d));return this}})(function(){return this}());(function(h){var f=h.Knot.K1M();f.KJ={_dataInMonitoring:[],_attachedInfoOfData:[],KK:function(d){if(f.Setting.enablePropertyHook){if(!d.__knot_attachedData){if("object"!=typeof d&&"array"!=typeof d)throw Error("Can only monitor object or array!");Object.defineProperty(d,"__knot_attachedData",{value:{},configurable:!0,writable:!1,enumerable:!1})}return d.__knot_attachedData}0>this._dataInMonitoring.indexOf(d)&&(this._dataInMonitoring.push(d),this._attachedInfoOfData[this._dataInMonitoring.indexOf(d)]=
{});return this._attachedInfoOfData[this._dataInMonitoring.indexOf(d)]},KL:function(d){f.Setting.enablePropertyHook?delete d.__knot_attachedData:(d=this._dataInMonitoring.indexOf(d),0<=d&&(delete this._dataInMonitoring[d],delete this._attachedInfoOfData[d]))}}})(function(){return this}());(function(h){var f=h.Knot.K1M();f.KM={on:function(d,b,a,c){d=f.KJ.KK(d);d.K1O||(d.K1O={});b||(b="*");d.K1O[b]||(d.K1O[b]=[]);d.K1O[b].push({callback:a,attachedData:c})},off:function(d,b,a){b||(b="*");var c=f.KJ.KK(d);if(c.K1O&&c.K1O[b]){for(var g=0;g<c.K1O[b].length;g++)if(c.K1O[b][g].callback==a){c.K1O[b].splice(g,
1);break}0==c.K1O[b].length&&(delete c.K1O[b],f.K1F.K1H(c)&&f.KJ.KL(d))}},KN:function(d,b,a){d=f.KJ.KK(d);if(d.K1O&&d.K1O[b])for(var c=0;c<d.K1O[b].length;c++)if(d.K1O[b][c].callback==a)return!0;return!1},KO:function(d,b,a){d=f.KJ.KK(d);if(d.K1O&&d.K1O[b])for(var c=0;c<d.K1O[b].length;c++)if(d.K1O[b][c].callback==
a)return d.K1O[b][c].attachedData;return null},notifyDataChanged:function(d,b,a,c){var g=f.KJ.KK(d);g.changedProperties||(g.changedProperties=[]);0>g.changedProperties.indexOf(b)&&g.changedProperties.push(b);if(g.K1O&&g.K1O[b])for(var e=g.K1O[b].slice(0),i=0;i<e.length;i++)try{e[i].callback.apply(d,[b,a,c])}catch(k){f.Log.warning("Call changed callback failed.",k)}if(g.K1O&&g.K1O["*"]){e=g.K1O["*"].slice(0);
for(i=0;i<e.length;i++)try{e[i].callback.apply(d,[b,a,c])}catch(j){f.Log.warning("Call changed callback failed.",j)}}},getPropertiesChangeRecords:function(d){d=f.KJ.KK(d);return!d?null:d.changedProperties?d.changedProperties:[]},clearPropertiesChangeRecords:function(d){d=f.KJ.KK(d);if(!d)return null;d.changedProperties=null},KP:function(d,b){if("*"!=b){var a=f.KJ.KK(d);a.dataHookInfo||(a.dataHookInfo={hookedProperties:[],
data:{},hookRefCount:{}});if(0<=a.dataHookInfo.hookedProperties.indexOf(b))a.dataHookInfo.hookRefCount[b]++;else{a.dataHookInfo.hookedProperties.push(b);a.dataHookInfo.data[b]=d[b];a.dataHookInfo.hookRefCount[b]=1;try{Object.defineProperty(d,b,{set:function(c){var e=a.dataHookInfo.data[b];if(e!=c){a.dataHookInfo.data[b]=c;f.KM.notifyDataChanged(this,b,e,c)}},get:function(){return a.dataHookInfo.data[b]},configurable:!0,enumerable:!0})}catch(c){a.dataHookInfo.hookFailed=!0,f.Log.warning("Hook property failed.",
c)}}}},KQ:function(d,b){if("*"!=b){var a=f.KJ.KK(d);a.dataHookInfo&&(!(0>a.dataHookInfo.hookedProperties.indexOf(b))&&!(0<--a.dataHookInfo.hookRefCount[b]))&&(a.dataHookInfo.hookFailed||(delete d[b],d[b]=a.dataHookInfo.data[b]),a.dataHookInfo.hookedProperties.splice(a.dataHookInfo.hookedProperties.indexOf(b),1),delete a.dataHookInfo.data[b],delete a.dataHookInfo.hookRefCount[b])}},KR:function(d,b){var a=f.KJ.KK(d);return!a.dataHookInfo?
!1:0<=a.dataHookInfo.hookedProperties.indexOf(b)},monitorObject:function(d,b,a,c){var g,e=b.substr(0,b.indexOf("."));e?g=b.substr(b.indexOf(".")+1):(e=b,g=null);var i={};f.KM.on(d,b,a,i);g&&(i.childChangedCallback=function(c,a,b){f.KM.notifyDataChanged(d,e+"."+g,a,b)},i.monitorChildChangedCallback=function(c,a,b){a&&f.KM.stopMonitoring(a,g,i.childChangedCallback);b&&f.KM.monitorObject(b,g,i.childChangedCallback,true);c=e+"."+g;b=f.K1F.getValueOnPath(b,g);
a=f.K1F.getValueOnPath(a,g);f.KM.notifyDataChanged(d,c,a,b)},f.KM.on(d,e,i.monitorChildChangedCallback),d[e]&&f.KM.monitorObject(d[e],g,i.childChangedCallback,!0));c||(i.changedCallback=function(e,c,a){if(c instanceof Array){f.KM.off(c,"*",i.arrayChangedCallback);delete i.arrayChangedCallback}if(a instanceof Array){i.arrayChangedCallback=function(){f.KM.notifyDataChanged(d,b,a,a)};f.KM.on(a,"*",i.arrayChangedCallback)}},f.KM.on(d,
b,i.changedCallback,i),a=f.K1F.getValueOnPath(d,b),a instanceof Array&&i.changedCallback("*",null,a));f.KM.KP(d,e)},monitor:function(d,b,a){if(b)"/"==b[0]&&(b=b.substr(1),d=h),this.monitorObject(d,b,a);else f.KM.on(d,null,a)},stopMonitoring:function(d,b,a){if(b){"/"==b[0]&&(b=b.substr(1),d=h);var c,g=b.substr(0,b.indexOf("."));g?c=b.substr(b.indexOf(".")+1):(g=b,c=null);var e=f.KM.KO(d,b,a);e&&(e.monitorChildChangedCallback&&f.KM.off(d,
g,e.monitorChildChangedCallback),e.childChangedCallback&&d[g]&&f.KM.stopMonitoring(d[g],c,e.childChangedCallback),e.changedCallback&&f.KM.off(d,b,e.changedCallback),e.arrayChangedCallback&&f.KM.off(f.K1F.getValueOnPath(d,b),"*",e.arrayChangedCallback));f.KM.off(d,b,a);f.KM.KQ(d,g)}else f.KM.off(d,b,a)}}})(function(){return this}());(function(h){function f(a){b[a]=Array.prototype[a];Array.prototype[a]=function(){var c=this.length,g=b[a].apply(this,arguments);this.__knot_attachedData&&(d.KM.notifyDataChanged(this,"*"),c!=this.length&&d.KM.notifyDataChanged(this,"length",c,this.length));return g}}var d=h.Knot.K1M(),b={};f("push");f("pop");f("unshift");f("shift");f("splice");f("sort");f("reverse");Array.prototype.notifyChanged=function(){this.__knot_attachedData&&(d.KM.notifyDataChanged(this,
"*"),d.KM.notifyDataChanged(this,"length",null,this.length))}})(function(){return this}());(function(h){var f=h.Knot.K1M(),d=0,b={};f.KS={KT:function(a,c){b[a]?f.Log.error("The global symbol'"+a+"' has been registered."):b[a]=c},KU:function(a){var c="s"+d++;b[c]=a;return"__knot_global."+c},KV:function(a){var a=a.split("."),c=h;"__knot_global"==a[0]&&(c=b,a.splice(0,1));for(var g=0;g<a.length;g++){if(null==c||"undefined"==typeof c)return;c=c[a[g]]}return c},KW:function(a){return f.K1F.K1G(a,"__knot_global.")}}})(function(){return this}());(function(h){function f(b){b="(function(value){"+b+"})";try{var a=d.KS.KU(eval(b))}catch(c){d.Log.error("Invalid pipe function: \r\n"+b,c)}return a}var d=h.Knot.K1M();d.K18={parse:function(b){for(var a=[],b=this.K1E(b),b=d.K1F.K1K(b,";"),c=0;c<b.length;c++){var g=d.K1F.K1K(b[c],"|"),e=this.K1C(g[0]);e&&(1<g.length&&(e.knotEvent=this.K1D(g[1])),a.push(e))}return a},K1E:function(b){for(var a=
d.K1F.K1J(b,0,"{","}");a;)var c=b.substr(a.start+1,a.end-a.start-1),c=f(c),b=b.substr(0,a.start)+c+b.substr(a.end+1),a=d.K1F.K1J(b,0,"{","}");return b},K1D:function(b){for(var b=b.split(","),a={},c=0;c<b.length;c++)if(d.K1F.trim(b[c])){var g=b[c].split(":");if(2!=g.length)d.Log.error("Invalid knot event option:"+b[c]);else{var e=d.K1F.trim(g[0]);if("@"!=e[0])d.Log.error("Invalid knot event :'"+e+"', it must start with '@'.");else{for(var g=d.K1F.trim(g[1]).split("&"),
i=[],k=0;k<g.length;k++){var j=d.K1F.trim(g[k]);"@"!=j[0]?d.Log.error("Invalid knot event handler:'"+e+"', it must start with '@'."):i.push(j)}0!=i.length&&(a[e]=i)}}}return a},K1C:function(b){b=d.K1F.trim(b);if(!b)return null;var a=d.K1F.K1K(b,":");if(2!=a.length)return d.Log.error("Invalid option:"+b),null;var c=this.K1B(a[0]),a=this.K1B(a[1]);return null==c||null==a||c.isComposite&&a.isComposite?(d.Log.error("Invalid option:"+b),null):
{leftAP:c,rightAP:a}},K1B:function(b){b=d.K1F.trim(b);if("("==b[0])return this.K19(b);var a=d.K1F.K1K(b,">"),b=d.K1F.trim(a[0]);a.splice(0,1);var a=a.map(function(e){return d.K1F.trim(e)}),c=null;if(d.KS.KW(b))a.splice(0,0,b),b="*";else if("]"==b[b.length-1]){var g=d.K1F.K1J(b,0,"[","]");g&&(c=this.K1A(b.substr(g.start+1,g.end-g.start-1)),b=b.substr(0,g.start))}return{description:b,pipes:a,
options:c}},K1A:function(b){for(var a={},b=d.K1F.K1K(b,";"),c=0;c<b.length;c++){var g=b[c].split(":");2!=g.length||!g[0]||!g[1]?d.Log.error("Invalid AP option:"+b[c]):a[d.K1F.trim(g[0])]=d.K1F.trim(g[1])}return a},K19:function(b){var a=d.K1F.K1J(b,0,"(",")");if(!a)return d.Log.error("Invalid composite option:"+b),null;for(var c=d.K1F.K1K(b.substr(a.start+1,a.end-a.start-1),"&"),g=[],e=0;e<c.length;e++){var i=this.K1B(c[e]);
if(null==i)return null;g.push(i)}for(a=a.end+1;">"!=b[a];){if(" "!=b[a]&&"\t"!=b[a]&&"a"!=b[a]&&"\n"!=b[a])return d.Log.error("Invalid composite option:"+b),null;a++}a++;a=d.K1F.trim(b.substr(a));return!a?(d.Log.error("Invalid composite option:"+b),null):{isComposite:!0,childrenAPs:g,nToOnePipe:a}}}})(function(){return this}());(function(h){function f(c,e,a,d){if(e&&e[a]){var j=b.K1F.getValueOnPath(null,e[a]);if(!j||"function"!=typeof j)b.Log.error("'"+e[e[a]]+"' must be a function.");else try{j.apply(c,d)}catch(f){b.Log.error("Call AP event handler '"+e[e[a]]+"' failed.",f)}}}function d(c,e,a,d){if(a.description&&("*"==a.description[0]||"!"==a.description[0])){var j=a.description,f=!1;if("!"==j[0]&&(j=b.K1F.trim(j.substr(1)),f=!0,"*"!=j[0]))return{target:d?c:e,ap:a};var h;b.K1F.K1G(j,"*LEFT")&&(h=j.substr(5),
d=!0);b.K1F.K1G(j,"*RIGHT")&&(h=j.substr(6),d=!1);""===h&&(h="*");h&&"."==h[0]&&(h=h.substr(1));if(h){f&&(h="!"+h);var j={},m;for(m in a)j[m]=a[m];j.description=h;a=j}}return{target:d?c:e,ap:a}}var b=h.Knot.K1M(),a=[],c=[];b.K3={K4:function(c,e){if(e&&"!"==e[0])return this.K5(c,e)||b.K2;for(var i=a.length-1;0<=i;i--)if(a[i].doesSupport(c,e))return a[i];return b.K2},K5:function(a,e){for(var b=
c.length-1;0<=b;b--)if(c[b].doesSupport(a,e))return c[b];return null},registerAPProvider:function(b,e){e?0>c.indexOf(b)&&c.push(b):0>a.indexOf(b)&&a.push(b)},unregisterAPProvider:function(b,e){e?0<=c.indexOf(b)&&c.splice(a.indexOf(b),1):0<=a.indexOf(b)&&a.splice(a.indexOf(b),1)},K8:{},K9:function(c,e){this.KD(c,e);var a=e.provider.getValue(c,e.description,e.options);try{if(e.pipes){for(var d=0;d<e.pipes.length;d++){var j=b.K1F.getValueOnPath(h,e.pipes[d]);
"function"!=typeof j&&b.Log.error("Pipe must be a function. pipe name:"+e.pipes[d]);a=j.apply(c,[a])}e.errorAPProvider&&e.errorAPProvider.setValue(c,"!"+e.description,void 0)}}catch(f){return e.errorAPProvider&&e.errorAPProvider.setValue(c,"!"+e.description,f),this.K8}return a},KA:function(c,e,a){if(!e.KB){e.KB=!0;try{this.KD(c,e),e.provider.setValue(c,e.description,a,e.options),f(c,e.options,"@set",[e.description,a])}finally{delete e.KB}}},
KC:function(c,e,a,d,j){if(a&&a.knotEvent&&a.knotEvent["@change"])for(var f=0;f<a.knotEvent["@change"].length;f++)try{b.K1F.getValueOnPath(null,a.knotEvent["@change"][f].substr(1))(c,e,a,d,j)}catch(h){b.Log.error("Call knot event 'change' handler failed.",h)}b.Debugger.knotChanged(c,e,a,d,j)},KD:function(c,e){e.provider||(e.provider=this.K4(c,e.description),e.errorAPProvider=this.K5(c,e.description))},monitor:function(c,e,a,d,j){this.KD(c,
e);this.KD(a,d);e.provider.doesSupportMonitoring(c,e.description)&&(e.changedCallback=function(){if(!d.KB){var h=b.K3.K9(c,e);if(h!=b.K3.K8){j.leftAP==e?b.K3.KC(c,a,j,h,!0):b.K3.KC(a,c,j,h,!1);e.KB=!0;try{b.K3.KA(a,d,h)}finally{delete e.KB}f(c,e.options,"@change",arguments)}}},e.provider.monitor(c,
e.description,e.changedCallback,e.options))},stopMonitoring:function(c,e){this.KD(c,e);e.provider.doesSupportMonitoring(c,e.description)&&e.changedCallback&&(e.provider.stopMonitoring(c,e.description,e.changedCallback,e.options),delete e.changedCallback)},KE:function(c,e,a,d,j){var n,o,m,l;c.isComposite?(n=c,o=e,m=a,l=d):(n=a,o=d,m=c,l=e);for(c=0;c<n.childrenAPs.length;c++)n.childrenAPs[c].provider=b.K3.K4(o,n.childrenAPs[c].description);l.provider=
b.K3.K4(l,m.description);n.changedCallback=function(){for(var c=[],a=0;a<n.childrenAPs.length;a++){var g=b.K3.K9(o,n.childrenAPs[a]);if(g==this.K8)return;c.push(g)}a=b.K1F.getValueOnPath(h,n.nToOnePipe);typeof a!="function"&&b.Log.error("Pipe must be a function. pipe name:"+n.nToOnePipe);c=a.apply(n,[c]);b.K3.KC(e,d,j,c,l==d);b.K3.KA(l,m,c);f(l,m,"@change",[e,d,
j])};for(c=0;c<n.childrenAPs.length;c++)n.childrenAPs[c].provider.doesSupportMonitoring(o,n.childrenAPs[c].description)&&n.childrenAPs[c].provider.monitor(o,n.childrenAPs[c].description,n.changedCallback,n.childrenAPs[c].options);n.changedCallback()},KF:function(c,e,a){var k=d(c,e,a.leftAP,!0),j=d(c,e,a.rightAP,!1),c=k.target,e=j.target,k=k.ap,j=j.ap;if(k.isComposite||j.isComposite)this.KE(k,c,j,e,a);else{this.KD(c,k);this.KD(e,j);var f=this.K9(e,
j);if(f==this.K8)return;this.KC(c,e,a,f,!1);this.KA(c,k,f);this.monitor(c,k,e,j,a);this.monitor(e,j,c,k,a)}b.Debugger.knotTied(c,e,a)},KG:function(c,a,i){var k=d(c,a,i.leftAP,!0),f=d(c,a,i.rightAP,!1),c=k.target,a=f.target,k=k.ap,f=f.ap;if(k.isComposite||f.isComposite){if(k.isComposite?(f=k,k=c):k=a,f.changedCallback)for(var h=0;h<f.childrenAPs.length;h++)f.childrenAPs[h].provider.doesSupportMonitoring(k,f.childrenAPs[h].description)&&f.childrenAPs[h].provider.stopMonitoring(k,
f.childrenAPs[h].description,f.changedCallback,f.childrenAPs[h].options)}else this.stopMonitoring(c,k,k.options),delete k.changedCallback,this.stopMonitoring(a,f,f.options);delete f.changedCallback;b.Debugger.knotUntied(c,a,i)},KH:function(c){c.changedCallback&&c.changedCallback()}};b.K2={doesSupport:function(){return!0},getValue:function(c,a){var d=!1;"@"==a[0]&&(d=!0,a=a.substr(1));var f=b.K1F.getValueOnPath(c,a);if("function"==typeof f&&!d)try{return f.apply(c)}catch(j){b.Log.error("Call get value function failed.",
j)}else return f},setValue:function(c,a,d){b.K1F.setValueOnPath(c,a,d)},doesSupportMonitoring:function(c){return"object"!=typeof c&&"array"!=typeof c?!1:!0},monitor:function(c,a,d){a&&"/"==a[0]&&(c=h,a=a.substr(1));c&&b.KM.monitor(c,a,d)},stopMonitoring:function(c,a,d){a&&"/"==a[0]&&(c=h,a=a.substr(1));c&&b.KM.stopMonitoring(c,a,d)}}})(function(){return this}());(function(h){function f(a){c.Kh.K15(a);a.parentNode.removeChild(a);c.Debugger.nodeRemoved(a)}function d(a,b,d){if(!d||!d.template)c.Log.error("No valid template is specified for 'content' access point. current node:"+c.KX.KY(a));else{var g=a.childNodes[0];if(g){if(!(g.__knot&&g.__knot.dataContext==b))if(null===b||"undefined"===typeof b)f(g);else{if(c.Kh.K10(d.template)){if(f(g),g=c.Kh.createFromTemplateAndUpdateData(d.template,
b,a))a.appendChild(g,b),c.Debugger.nodeAdded(h)}else c.Kh.K13(g,b);g.__knot&&(g.__knot={});g.__knot.dataContext=b}}else if(!(null===b||"undefined"===typeof b)){var h=c.Kh.createFromTemplateAndUpdateData(d.template,b,a);h&&(a.appendChild(h,b),c.Debugger.nodeAdded(h))}}}function b(a,b,d,g,h){b||(b=[]);for(var o=0;o<b.length;o++){var m;a:{for(var l=o;l<a.children.length;l++)if(a.children[l].__knot&&a.children[l].__knot.dataContext==b[o]){m=a.children[l];break a}m=
null}if(m){if(Array.prototype.indexOf.call(a.children,m)!=o){a.removeChild(m);var l=a,p=o;l.children.length==p?l.appendChild(m):l.insertBefore(m,l.children[p])}}else{var q=c.Kh.createFromTemplateAndUpdateData(d,b[o],a);q&&(l=a,m=q,p=o,l.children.length==p?l.appendChild(m):l.insertBefore(m,l.children[p]),c.Debugger.nodeAdded(q),g&&g.apply(a,[q]))}}for(o=a.children.length-1;o>=b.length;o--)f(a.children[o]),h&&h.apply(a,[q])}function a(a,d,g){!g||!g.template?c.Log.error("No valid template is specified for 'foreach' access point. current node:"+
c.KX.KY(a)):b(a,d,g.template,c.K1F.getValueOnPath(a,g["@added"]),c.K1F.getValueOnPath(a,g["@removed"]))}var c=h.Knot.K1M(),g=[];g["input.value"]="change";g["textarea.value"]="change";g["input.checked"]="change";g["select.selectedindex"]="change";g["select.value"]="change";c.KX={KY:function(c){var a=c.tagName;c.id?a+="[#"+c.id+"]":c.className&&(a+="["+c.className.split(" ").filter(function(c){return c.trim()!=""}).map(function(c){return"."+
c}).join(" ")+"]");return a},KZ:function(a){a=c.K1F.K1K(a,".");return c.K1F.trim(a[0])},Ka:function(a){a=c.K1F.K1K(a,".");if(1<a.length)return a.slice(1).join(".")},Kb:function(a,b){return!a?void 0:c.K1F.getValueOnPath(a,b)},Kc:function(a){var b={apName:a,options:{}},d=c.K1F.K1J(a,0,"[","]");if(d){b.apName=c.K1F.trim(a.substr(0,d.start));a=a.substr(d.start+
1,d.end-d.start-1);a=a.split(";");for(d=0;d<a.length;d++){var g=a[d].split(":");2!=g.length?c.Log.error("Invalid options:"+a[d]):b.options[c.K1F.trim(g[0])]=c.K1F.trim(g[1])}}else b.apName=a;return b},Kd:function(a){if(0<a.indexOf("(")){var b=c.K1F.K1J(a,0,"(",")");if(b)try{var d=a.substr(b.start+1,b.end-b.start-1);return document.querySelector(d)}catch(g){c.Log.error("Query selector failed.",g)}else c.Log.error("Unknown selector:"+a)}else return document.querySelector(a)}};
c.Kf={doesSupport:function(a,c){return"#"==c[0]?!0:"!"==c[0]?!1:a instanceof HTMLElement?!0:!1},getValue:function(a,b){if("@"!=b[0]&&("#"==b[0]&&(a=c.KX.Kd(c.KX.KZ(b)),b=c.KX.Ka(b)),!c.K1F.K1G(b,"content")&&!c.K1F.K1G(b,"foreach")))return c.KX.Kb(a,b)},setValue:function(b,g,f,h){"@"==g[0]?("function"!=typeof f&&c.Log.error("Event listener must be a function!"),
b&&b.addEventListener(g.substr(1),function(a){f.apply(b.__knot.dataContext,[a,b])})):("#"==g[0]&&(b=c.KX.Kd(c.KX.KZ(g)),g=c.KX.Ka(g)),c.K1F.K1G(g,"content"))?d(b,f,h):c.K1F.K1G(g,"foreach")?a(b,f,h):("undefined"==typeof f&&(f=""),c.K1F.setValueOnPath(b,g,f))},doesSupportMonitoring:function(a,b){"#"==b[0]&&(a=c.KX.Kd(c.KX.KZ(b)),b=c.KX.Ka(b));
if(!a)return!1;var d=a.tagName.toLowerCase()+"."+b.toLowerCase();return g[d]?!0:!1},monitor:function(a,b,d,f){"#"==b[0]&&(a=c.KX.Kd(c.KX.KZ(b)),b=c.KX.Ka(b));for(var b=a.tagName.toLowerCase()+"."+b.toLowerCase(),b=g[b].split(","),h=0;h<b.length;h++)a.addEventListener(b[h],d);("input"==a.tagName.toLowerCase()||"textarea"==a.tagName.toLowerCase())&&(f&&(1==f.immediately||"true"==f.immediately.toLowerCase()))&&a.addEventListener("keyup",
d)},stopMonitoring:function(a,b,d,f){"#"==b[0]&&(a=c.KX.Kd(c.KX.KZ(b)),b=c.KX.Ka(b));for(var b=a.tagName.toLowerCase()+"."+b.toLowerCase(),b=g[b].split(","),h=0;h<b.length;h++)a.removeEventListener(b[h],d);("input"==a.tagName.toLowerCase()||"textarea"==a.tagName.toLowerCase())&&(f&&(1==f.immediately||"true"==f.immediately.toLowerCase()))&&a.removeEventListener("keyup",d)},syncItems:b};c.K3.registerAPProvider(c.Kf);
c.Kg={doesSupport:function(a,b){b&&("!"==b[0]&&(b=b.substr(1)),"#"==b[0]&&(a=c.KX.Kd(c.KX.KZ(b))));return a instanceof HTMLElement},getValue:function(a,b){if("!"==b[0]&&(b=b.substr(1),"#"==b[0]&&(a=c.KX.Kd(c.KX.KZ(b)),b=c.KX.Ka(b)),a))return!a.__knot_errorStatusInfo||!a.__knot_errorStatusInfo[b]?null:a.__knot_errorStatusInfo[b].currentStatus},setValue:function(a,
b,d){if("!"==b[0]&&(b=b.substr(1),"#"==b[0]&&(a=c.KX.Kd(c.KX.KZ(b)),b=c.KX.Ka(b)),a&&(d||a.__knot_errorStatusInfo&&a.__knot_errorStatusInfo[b]&&a.__knot_errorStatusInfo[b].K1O)))if(a.__knot_errorStatusInfo||(a.__knot_errorStatusInfo={}),a.__knot_errorStatusInfo[b]||(a.__knot_errorStatusInfo[b]={}),a.__knot_errorStatusInfo[b].currentStatus=d,a.__knot_errorStatusInfo[b].K1O)for(var g=a.__knot_errorStatusInfo[b].K1O,
f=0;f<g.length;f++)try{g[f].apply(a,[b,d])}catch(h){c.Log.warning("Call error status changed callback failed.",h)}},doesSupportMonitoring:function(a,c){return"!"==c[0]?!0:!1},monitor:function(a,b,d){"!"==b[0]&&(b=b.substr(1),"#"==b[0]&&(a=c.KX.Kd(c.KX.KZ(b)),b=c.KX.Ka(b)),a.__knot_errorStatusInfo||(a.__knot_errorStatusInfo={}),a.__knot_errorStatusInfo[b]||(a.__knot_errorStatusInfo[b]={}),a.__knot_errorStatusInfo[b].K1O||
(a.__knot_errorStatusInfo[b].K1O=[]),a.__knot_errorStatusInfo[b].K1O.push(d))},stopMonitoring:function(a,b,d){"#"==b[1]&&(a=c.KX.Kd(c.KX.KZ(b.substr(1))),b=c.KX.Ka(b.substr(1)));a.__knot_errorStatusInfo&&(a.__knot_errorStatusInfo[b]&&a.__knot_errorStatusInfo[b].K1O)&&(d=a.__knot_errorStatusInfo[b].K1O.indexOf(d),0<=d&&a.__knot_errorStatusInfo[b].K1O.splice(d,
1))},getErrorStatusInformation:function(a,c){if(a.__knot_errorStatusInfo)for(var b in a.__knot_errorStatusInfo)a.__knot_errorStatusInfo[b]&&a.__knot_errorStatusInfo[b].currentStatus&&c.push({node:a,K1P:b,error:a.__knot_errorStatusInfo[b].currentStatus});for(b=0;b<a.children.length;b++)this.getErrorStatusInformation(a.children[b],c)}};c.K3.registerAPProvider(c.Kg,!0)})(function(){return this}());(function(h){function f(a){if(!a||""==a)return null;for(var c;0<=(c=a.indexOf("/*"));){var d=a.indexOf("*/",c);if(0>d)throw Error("Can't find close mark for comment.");a=a.substr(0,c)+a.substr(d+2)}a=a.split("\n");c="";for(d=0;d<a.length;d++)for(var e=a[d].split("\r"),f=0;f<e.length;f++)"//"!=b.K1F.trim(e[f]).substr(0,2)&&(c+=e[f]);return c}function d(a){if(!a)return null;for(var c=0;c<a.length;c++)if("dataContext"==a[c].leftAP.description)return a[c];return null}var b=h.Knot.K1M();
b.Kh={Ki:{},Kj:[],Kk:{},Kl:function(){for(var a=new b.Deferred,c=h.document.querySelectorAll('script[type="text/cbs"]'),d=this,e=0,i=0;i<c.length;i++)if(c[i].src)e++,function(){var h=c[i].src,k=b.K1F.K1I();k.onreadystatechange=function(){if(4==k.readyState)if(200==k.status)try{var c=f(k.responseText);d.Km(c);e--;if(0==e)try{a.resolve()}catch(i){b.Log.error("Initialize failed.  message:"+i.message,i)}}catch(l){b.Log.error("Load CBS script error. url:"+
h+" message:"+l.message,l),a.reject(l)}else b.Log.error("Load CBS script error. url:"+h+" message:"+k.statusText),a.reject(Error("Load CBS script error. url:"+h+" message:"+k.statusText))};k.open("GET",h,!0);k.send()}();else try{this.Km(f(c[i].textContent))}catch(k){a.reject(k)}0==e&&a.resolve();return a},Km:function(a){a=b.K1F.trim(a);if(b.K1F.K1G(a,"$private")){var c={CBS:{}},a=a.substr(8),a=this.Kn(c,a);this.Ko(c.CBS,a);this.Kj.push(c)}else this.Ko(this.Ki,
a)},Kn:function(a,c){a.HTML||(a.HTML="");for(var d=0,e="",f=b.K1F.K1J(c,d,"<<{{","}}>>");null!=f;)e+=c.substr(d,f.start-d),a.HTML+=c.substr(f.start+4,f.end-f.start-4),d=f.end+4,f=b.K1F.K1J(c,d,"<<{{","}}>>");d<c.length&&(e+=c.substr(d));return e},Ko:function(a,c){for(var d=0,e=b.K1F.K1J(c,d,"{","}");null!=e;){d=c.substr(d,e.start-d);d=b.K1F.trim(d);a[d]||(a[d]=[]);for(var f=c.substr(e.start+1,e.end-e.start-1),f=b.K18.K1E(f),
f=b.K1F.K1K(f,";"),h=0;h<f.length;h++){var j=b.K1F.trim(f[h]);0>a[d].indexOf(j)&&a[d].push(j)}d=e.end+1;e=b.K1F.K1J(c,d,"{","}")}},Kp:[],Kq:function(a){var c=null;a.__knot&&a.__knot.cbsOptions&&(c=a.__knot.cbsOptions,delete a.__knot.cbsOptions);if(a.attributes.binding&&a.attributes.binding.value){c||(c=[]);var d=a.attributes.binding.value,d=b.K18.K1E(d),d=d.split(";").map(function(a){return b.K1F.trim(a)}),
c=c.concat(d)}if(c)for(d=0;d<c.length;d++){a.__knot||(a.__knot={options:[]});var e=b.K18.parse(c[d]);0!=e.length&&(a.__knot.options.push(e[0]),this.Kr(e[0].leftAP)&&0>this.Kp.indexOf(a)&&this.Kp.push(a))}for(c=0;c<a.children.length;c++)this.Kq(a.children[c])},Kr:function(a){return"foreach"==a.description||"content"==a.description},Ks:function(){if(0<this.Kj.length){for(var a="",c=0;c<
this.Kj.length;c++)a+=this.Kj[c].HTML;this.K1N=document.createElement("DIV");this.K1N.innerHTML=a;for(c=0;c<this.Kj.length;c++)this.Kt(this.K1N,this.Kj[c].CBS),this.Kq(this.K1N)}this.Kt(document,this.Ki);this.Kq(document.body)},Kt:function(a,c){for(var d in c){var e=a.querySelectorAll(d);0==e.length&&b.Log.warning("There is no element selected with selector:"+
d);for(var f=0;f<e.length;f++){var h=c[d].slice(0);e[f].__knot||(e[f].__knot={options:[]});e[f].__knot.cbsOptions&&(h=e[f].__knot.cbsOptions.concat(h));e[f].__knot.cbsOptions=h}}},Ku:0,Kv:function(){var a=[];this.K1N&&(a=a.concat(this.Kw(this.K1N)));for(var a=a.concat(this.Kw(document)),c=0;c<this.Kp.length;c++)for(var d=0;d<this.Kp[c].__knot.options.length;d++)this.Kr(this.Kp[c].__knot.options[d].leftAP)&&
this.Kx(this.Kp[c],this.Kp[c].__knot.options[d].leftAP),this.Kr(this.Kp[c].__knot.options[d].rightAP)&&this.Kx(this.Kp[c],this.Kp[c].__knot.options[d].rightAP);for(c=this.Kp.length=0;c<a.length;c++)delete a[c].__knot_template_id,a[c].removeAttribute("knot-template"),a[c].removeAttribute("knot-template-id"),a[c].parentNode.removeChild(a[c]);this.K1N&&
(0<this.K1N.children.length&&b.Log.warning("Useless HTML is detected in private scope."+this.K1N.innerHTML),this.K1N=null)},Kw:function(a){for(var a=a.querySelectorAll("*[knot-template], *[knot-template-id]"),c=0;c<a.length;c++){var b;b=a[c].getAttribute("knot-template-id")?a[c].getAttribute("knot-template-id"):"knot_template_"+this.Ku++;this.Kk[b]=a[c];a[c].__knot_template_id=b}return Array.prototype.slice.apply(a,[0])},
Kx:function(a,c){var d;if(!c.options||!c.options.template){if(d=a.children[0],1<a.children.length&&b.Log.warning("More than one child is found within '"+b.KX.KY(a)+'", only the first will be taken as template and the reset will be removed.'),!d){b.Log.error("Can't find template within'"+b.KX.KY(a)+"'");return}}else{var e=c.options.template;if("@"==e[0])return;d=this.Kk[e];if(!d){b.Log.error("Can't find template with selector'"+
e+"'");return}}d.__knot_template_id||b.Log.error("The template node must be marked with 'knot-template'. Current node:'"+b.KX.KY(a)+"'");c.options||(c.options={});c.options.template=d.__knot_template_id},Ky:function(a,c){a.__knot?c.__knot=JSON.parse(JSON.stringify(a.__knot)):delete c.__knot;for(var b=0;b<a.children.length;b++)this.Ky(a.children[b],c.children[b])},Kz:function(a){var c=a.cloneNode(!0);this.Ky(a,c);return c},
K10:function(a){return!this.Kk[a]},createFromTemplate:function(a){if(this.Kk[a])return this.Kz(this.Kk[a]);b.Log.error("Failed find template. id:"+a)},createFromTemplateAndUpdateData:function(a,c,d){if("function"==typeof a||!this.Kk[a]){var e;e="function"==typeof a?a:b.K1F.getValueOnPath(c,a);if("function"==typeof e){if(d=e.apply(d,[c]),!d){b.Log.error("Template function must return a HTML element. template:"+a);return}}else{b.Log.error("Unknown template:"+
a);return}}else{d=this.createFromTemplate(a);if(!d)return;this.K13(d,c)}d.__knot?d.__knot.dataContext=c:d.__knot={dataContext:c};return d},K11:function(a){if(a.__knot&&a.__knot.options)for(var c=0;c<a.__knot.options.length;c++)"dataContext"!=a.__knot.options[c].leftAP.description&&b.K3.KG(a,a.__knot.dataContext,a.__knot.options[c])},K12:function(a){if(a.__knot&&a.__knot.options)for(var c=0;c<a.__knot.options.length;c++)"dataContext"!=a.__knot.options[c].leftAP.description&&
b.K3.KF(a,a.__knot.dataContext,a.__knot.options[c])},K13:function(a,c){if(a.__knot){var g=d(a.__knot.options),e=c;if(g){e=b.K3.K9(c,g.rightAP);if(e==b.K3.K8){b.Log.error("Get context data failed. node:"+b.KX.KY(a));return}if(g.hasTiedUpKnot&&e===a.__knot.dataContext)return;(g.data||"/"==g.rightAP.description[0])&&g.changedCallback&&g.rightAP.provider.stopMonitoring(g.data,
g.rightAP.description,g.changedCallback,g.rightAP.options);g.data=c;g.data||"/"==g.rightAP.description[0]?(g.changedCallback=function(){b.Kh.K13(a,c)},g.rightAP.provider.monitor(g.data,g.rightAP.description,g.changedCallback,g.rightAP.options)):g.changedCallback=null;g.hasTiedUpKnot=!0}this.K11(a);b.K3.KC(a,c,g,e,!1);for(g=0;g<a.childNodes.length;g++)this.K13(a.childNodes[g],e);a.__knot.dataContext=e;this.K12(a)}else for(g=
0;g<a.childNodes.length;g++)this.K13(a.childNodes[g],c)},K14:function(a){for(;a;){if(a.__knot)return a.__knot.dataContext;a=a.parentNode}},K15:function(a){if(a.__knot){var c=d(a.__knot.options);c&&((c.data||"/"==c.rightAP.description[0])&&c.changedCallback&&c.rightAP.provider.stopMonitoring(c.data,c.rightAP.description,c.changedCallback,c.rightAP.options),c.data=null,c.changedCallback=null,c.hasTiedUpKnot=!1);this.K11(a);delete a.__knot.dataContext}for(c=
0;c<a.childNodes.length;c++)this.K15(a.childNodes[c])},bind:function(){this.K13(document.body,null)},clear:function(){this.K15(document.body)},K16:function(a,c){a.__knot||(a.__knot={});a.__knot.dataContext=c},K1L:function(a){if(a.__knot)return a.__knot.dataContext},K17:function(a){if(a.__knot&&a.__knot.options)for(var c=0;c<a.__knot.options.length;c++)"dataContext"!=a.__knot.options[c].leftAP.description&&!(a.__knot.options[c].leftAP.description&&
"!"==a.__knot.options[c].leftAP.description[0])&&b.K3.KH(a.__knot.options[c].leftAP);for(c=0;c<a.children.length;c++)this.K17(a.children[c])}}})(function(){return this}());(function(h){function f(){b&&(a?b(!1,a):h.Knot.isReady&&b(!0))}var d=h.Knot.K1M();delete h.Knot.K1M;h.Knot.Advanced={registerAPProvider:function(a){return d.K3.registerAPProvider(a)},registerLog:function(a){d.Log.log=a},registerDebugger:function(a){d.Debugger=a},synchronizeItems:function(a,b,e,f,h){d.Kf.syncItems(a,b,e,f,h)},createFromTemplate:function(a,b,e){return d.Kh.createFromTemplateAndUpdateData(a,b,e)},getValueOnPath:function(a,
b){return d.K1F.getValueOnPath(a,b)},registerNamedGlobalSymbol:function(a,b){return d.KS.KT(a,b)}};h.Knot.getErrorStatusInformation=function(a){a||(a=document.body);d.Kh.K17(a);var b=[];d.Kg.getErrorStatusInformation(a,b);return b};h.Knot.notifyObjectChanged=function(a,b,e,f){d.KM.notifyDataChanged(a,b,e,f)};h.Knot.monitorObject=function(a,b,e){d.KM.monitorObject(a,b,e)};h.Knot.stopMonitoringObject=
function(a,b,e){d.KM.stopMonitoring(a,b,e)};h.Knot.getPropertiesChangeRecords=function(a){return d.KM.getPropertiesChangeRecords(a)};h.Knot.clearPropertiesChangeRecords=function(a){return d.KM.clearPropertiesChangeRecords(a)};h.Knot.clear=function(){d.Kh.clear()};h.Knot.getDataContext=function(a){return d.Kh.K14(a)};h.Knot.findElementBindToData=function(a,b){for(var d=0;d<a.length;d++)if(h.Knot.getDataContext(a[d])==b)return a};
var b,a;h.Knot.ready=function(c){b=c;(h.Knot.isReady||null!=a)&&f()};h.Knot.isReady=!1;h.addEventListener("load",function(){d.Kh.Kl().done(function(){d.Kh.Ks();d.Kh.Kv();d.Kh.bind();h.Knot.isReady=!0;a=null;f()},function(b){h.Knot.isReady=!1;a=b;f()})})})(function(){return this}());
