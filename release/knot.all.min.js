(function(g){var e={Setting:{enablePropertyHook:!0},Log:{Level:{Info:"Info",Warning:"Warning",Error:"Error"},log:function(d,a,b){console.log("["+d+"]"+a);b&&console.log(b)},info:function(d,a){this.log(this.Level.Info,d,a)},warning:function(d,a){this.log(this.Level.Warning,d,a)},error:function(d,a){this.log(this.Level.Error,d,a)}},Debugger:{knotChanged:function(){},knotTied:function(){},knotUntied:function(){},nodeAdded:function(){},nodeRemoved:function(){}}};g.Knot={K1M:function(){return e}}})(function(){return this}());(function(g){var e=g.Knot.K1M();e.K1F={K1H:function(d){for(var a in d)return!1;return!0},trim:function(d){return d.trim?d.trim():d.replace(/^\s+|\s+$/g,"")},K1G:function(d,a){return!d?!1:d.substr(0,a.length)==a},getValueOnPath:function(d,a){if(a||""===a){if("*NULL"==a)return null;if("*"==a||""==a)return d;var b=!1;"@"==a[0]&&(b=!0,a=a.substr(1));var c;if(this.K1G(a,"__knot_global"))c=e.KS.KV(a);else{var f=d;"/"==a[0]&&(f=g,a=a.substr(1));
for(;0<=a.indexOf(".")&&f;)var h=e.K1F.trim(a.substr(0,a.indexOf("."))),f="*"!=h?f[h]:void 0,a=e.K1F.trim(a.substr(a.indexOf(".")+1));"*"==a?c=f:f&&(c=f[a])}if(b&&c&&"function"!=typeof c)e.Log.error("'"+a+"' is expected as a function, but it isn't.");else return c}},setValueOnPath:function(d,a,b){if("*"!=a[a.length-1]){if(this.K1G(a,"__knot_global"))throw Error("Can't set global symbol!");a&&"/"==a[0]&&(d=g,a=a.substr(1));var c=a,f=a.lastIndexOf(".");0<f&&(c=a.substr(f+1),d=this.getValueOnPath(d,
a.substr(0,f)));d&&(d[c]=b)}},K1I:function(){return g.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},K1J:function(d,a,b,c){var f={start:-1,end:-1};f.start=d.indexOf(b,a);if(0>f.start)return null;for(var a=0,h=f.start+1;;){var i=d.indexOf(b,h),h=d.indexOf(c,h);if(0>h)break;if(0>i||h<i){if(0==a){f.end=h;break}else a--;h+=1}else a++,h=i+1}return 0<=f.start&&0<=f.end?f:null},Kc:function(d){var a=this.K1J(d,0,"[","]");if(!a){d=d.substr(a.start+
1,a.end-a.start-1);d=d.split(",");for(a=0;a<d.length;a++);}},K1K:function(d,a){var b=0;prev=0;for(var c=[],f=0,h=0;b<d.length;){switch(d[b]){case "(":f++;break;case ")":f=Math.max(0,f-1);break;case "[":h++;break;case "]":h=Math.max(0,h-1);break;case a:0==f&&0==h&&(c.push(d.substr(prev,b-prev)),prev=b+1)}b++}b>=prev&&c.push(d.substr(prev,b-prev));return c}}})(function(){return this}());(function(g){g=g.Knot.K1M();g.Deferred=function(){this._succCallbacks=[];this._errCallbacks=[];this.isRejected=this.isFinished=!1;this.result=null};g.Deferred.prototype.resolve=function(e){this.result=e;this.isFinished=!0;this.isRejected=!1;for(var d=0;d<this._succCallbacks.length;d++)this._succCallbacks[d](e)};g.Deferred.prototype.reject=function(e){this.result=e;this.isRejected=this.isFinished=!0;for(var d=0;d<this._errCallbacks.length;d++)this._errCallbacks[d](e)};g.Deferred.prototype.done=
function(e,d){this.isFinished?this.isRejected?d(this.result):e(this.result):(this._succCallbacks.push(e),this._errCallbacks.push(d));return this}})(function(){return this}());(function(g){var e=g.Knot.K1M();e.KJ={_dataInMonitoring:[],_attachedInfoOfData:[],KK:function(d){if(e.Setting.enablePropertyHook){if(!d.__knot_attachedData){if("object"!=typeof d&&"array"!=typeof d)throw Error("Can only monitor object or array!");Object.defineProperty(d,"__knot_attachedData",{value:{},configurable:!0,writable:!1,enumerable:!1})}return d.__knot_attachedData}0>this._dataInMonitoring.indexOf(d)&&(this._dataInMonitoring.push(d),this._attachedInfoOfData[this._dataInMonitoring.indexOf(d)]=
{});return this._attachedInfoOfData[this._dataInMonitoring.indexOf(d)]},KL:function(d){e.Setting.enablePropertyHook?delete d.__knot_attachedData:(d=this._dataInMonitoring.indexOf(d),0<=d&&(delete this._dataInMonitoring[d],delete this._attachedInfoOfData[d]))}}})(function(){return this}());(function(g){var e=g.Knot.K1M();e.KM={on:function(d,a,b,c){d=e.KJ.KK(d);d.K1O||(d.K1O={});a||(a="*");d.K1O[a]||(d.K1O[a]=[]);d.K1O[a].push({callback:b,attachedData:c})},off:function(d,a,b){a||(a="*");var c=e.KJ.KK(d);if(c.K1O&&c.K1O[a]){for(var f=0;f<c.K1O[a].length;f++)if(c.K1O[a][f].callback==b){c.K1O[a].splice(f,
1);break}0==c.K1O[a].length&&(delete c.K1O[a],e.K1F.K1H(c)&&e.KJ.KL(d))}},KN:function(d,a,b){d=e.KJ.KK(d);if(d.K1O&&d.K1O[a])for(var c=0;c<d.K1O[a].length;c++)if(d.K1O[a][c].callback==b)return!0;return!1},KO:function(d,a,b){d=e.KJ.KK(d);if(d.K1O&&d.K1O[a])for(var c=0;c<d.K1O[a].length;c++)if(d.K1O[a][c].callback==
b)return d.K1O[a][c].attachedData;return null},notifyDataChanged:function(d,a,b,c){var f=e.KJ.KK(d);f.changedProperties||(f.changedProperties=[]);0>f.changedProperties.indexOf(a)&&f.changedProperties.push(a);if(f.K1O&&f.K1O[a])for(var h=f.K1O[a].slice(0),i=0;i<h.length;i++)try{h[i].callback.apply(d,[a,b,c])}catch(l){e.Log.warning("Call changed callback failed.",l)}if(f.K1O&&f.K1O["*"]){h=f.K1O["*"].slice(0);
for(i=0;i<h.length;i++)try{h[i].callback.apply(d,[a,b,c])}catch(k){e.Log.warning("Call changed callback failed.",k)}}},getPropertiesChangeRecords:function(d){d=e.KJ.KK(d);return!d?null:d.changedProperties?d.changedProperties:[]},clearPropertiesChangeRecords:function(d){d=e.KJ.KK(d);if(!d)return null;d.changedProperties=null},KP:function(d,a){if("*"!=a){var b=e.KJ.KK(d);b.dataHookInfo||(b.dataHookInfo={hookedProperties:[],
data:{},hookRefCount:{}});if(0<=b.dataHookInfo.hookedProperties.indexOf(a))b.dataHookInfo.hookRefCount[a]++;else{b.dataHookInfo.hookedProperties.push(a);b.dataHookInfo.data[a]=d[a];b.dataHookInfo.hookRefCount[a]=1;try{Object.defineProperty(d,a,{set:function(c){var h=b.dataHookInfo.data[a];if(h!=c){b.dataHookInfo.data[a]=c;e.KM.notifyDataChanged(this,a,h,c)}},get:function(){return b.dataHookInfo.data[a]},configurable:!0,enumerable:!0})}catch(c){b.dataHookInfo.hookFailed=!0,e.Log.warning("Hook property failed.",
c)}}}},KQ:function(d,a){if("*"!=a){var b=e.KJ.KK(d);b.dataHookInfo&&(!(0>b.dataHookInfo.hookedProperties.indexOf(a))&&!(0<--b.dataHookInfo.hookRefCount[a]))&&(b.dataHookInfo.hookFailed||(delete d[a],d[a]=b.dataHookInfo.data[a]),b.dataHookInfo.hookedProperties.splice(b.dataHookInfo.hookedProperties.indexOf(a),1),delete b.dataHookInfo.data[a],delete b.dataHookInfo.hookRefCount[a])}},KR:function(d,a){var b=e.KJ.KK(d);return!b.dataHookInfo?
!1:0<=b.dataHookInfo.hookedProperties.indexOf(a)},monitorObject:function(d,a,b,c){var f,h=a.substr(0,a.indexOf("."));h?f=a.substr(a.indexOf(".")+1):(h=a,f=null);var i={};e.KM.on(d,a,b,i);f&&(i.childChangedCallback=function(c,a,b){e.KM.notifyDataChanged(d,h+"."+f,a,b)},i.monitorChildChangedCallback=function(c,a,b){a&&e.KM.stopMonitoring(a,f,i.childChangedCallback);b&&e.KM.monitorObject(b,f,i.childChangedCallback,true);c=h+"."+f;b=e.K1F.getValueOnPath(b,f);
a=e.K1F.getValueOnPath(a,f);e.KM.notifyDataChanged(d,c,a,b)},e.KM.on(d,h,i.monitorChildChangedCallback),d[h]&&e.KM.monitorObject(d[h],f,i.childChangedCallback,!0));c||(i.changedCallback=function(c,h,b){if(h instanceof Array){e.KM.off(h,"*",i.arrayChangedCallback);delete i.arrayChangedCallback}if(b instanceof Array){i.arrayChangedCallback=function(){e.KM.notifyDataChanged(d,a,b,b)};e.KM.on(b,"*",i.arrayChangedCallback)}},e.KM.on(d,
a,i.changedCallback,i),b=e.K1F.getValueOnPath(d,a),b instanceof Array&&i.changedCallback("*",null,b));e.KM.KP(d,h)},monitor:function(d,a,b){if(a)"/"==a[0]&&(a=a.substr(1),d=g),this.monitorObject(d,a,b);else e.KM.on(d,null,b)},stopMonitoring:function(d,a,b){if(a){"/"==a[0]&&(a=a.substr(1),d=g);var c,f=a.substr(0,a.indexOf("."));f?c=a.substr(a.indexOf(".")+1):(f=a,c=null);var h=e.KM.KO(d,a,b);h&&(h.monitorChildChangedCallback&&e.KM.off(d,
f,h.monitorChildChangedCallback),h.childChangedCallback&&d[f]&&e.KM.stopMonitoring(d[f],c,h.childChangedCallback),h.changedCallback&&e.KM.off(d,a,h.changedCallback),h.arrayChangedCallback&&e.KM.off(e.K1F.getValueOnPath(d,a),"*",h.arrayChangedCallback));e.KM.off(d,a,b);e.KM.KQ(d,f)}else e.KM.off(d,a,b)}}})(function(){return this}());(function(g){function e(b){a[b]=Array.prototype[b];Array.prototype[b]=function(){var c=this.length,f=a[b].apply(this,arguments);this.__knot_attachedData&&(d.KM.notifyDataChanged(this,"*"),c!=this.length&&d.KM.notifyDataChanged(this,"length",c,this.length));return f}}var d=g.Knot.K1M(),a={};e("push");e("pop");e("unshift");e("shift");e("splice");e("sort");e("reverse");Array.prototype.notifyChanged=function(){this.__knot_attachedData&&(d.KM.notifyDataChanged(this,
"*"),d.KM.notifyDataChanged(this,"length",null,this.length))}})(function(){return this}());(function(g){var e=g.Knot.K1M(),d=0,a={};e.KS={KT:function(b,c){a[b]?e.Log.error("The global symbol'"+b+"' has been registered."):a[b]=c},KU:function(b){var c="s"+d++;a[c]=b;return"__knot_global."+c},KV:function(b){var b=b.split("."),c=g;"__knot_global"==b[0]&&(c=a,b.splice(0,1));for(var f=0;f<b.length;f++){if(null==c||"undefined"==typeof c)return;c=c[b[f]]}return c},KW:function(a){return e.K1F.K1G(a,"__knot_global.")}}})(function(){return this}());(function(g){function e(a){a="(function(value){"+a+"})";try{var b=d.KS.KU(eval(a))}catch(c){d.Log.error("Invalid pipe function: \r\n"+a,c)}return b}var d=g.Knot.K1M();d.K18={parse:function(a){for(var b=[],a=this.K1E(a),a=d.K1F.K1K(a,";"),c=0;c<a.length;c++){var f=d.K1F.K1K(a[c],"|"),h=this.K1C(f[0]);h&&(1<f.length&&(h.knotEvent=this.K1D(f[1])),b.push(h))}return b},K1E:function(a){for(var b=
d.K1F.K1J(a,0,"{","}");b;)var c=a.substr(b.start+1,b.end-b.start-1),c=e(c),a=a.substr(0,b.start)+c+a.substr(b.end+1),b=d.K1F.K1J(a,0,"{","}");return a},K1D:function(a){for(var a=a.split(","),b={},c=0;c<a.length;c++)if(d.K1F.trim(a[c])){var f=a[c].split(":");if(2!=f.length)d.Log.error("Invalid knot event option:"+a[c]);else{var h=d.K1F.trim(f[0]);if("@"!=h[0])d.Log.error("Invalid knot event :'"+h+"', it must start with '@'.");else{for(var f=d.K1F.trim(f[1]).split("&"),
i=[],l=0;l<f.length;l++){var e=d.K1F.trim(f[l]);"@"!=e[0]?d.Log.error("Invalid knot event handler:'"+h+"', it must start with '@'."):i.push(e)}0!=i.length&&(b[h]=i)}}}return b},K1C:function(a){a=d.K1F.trim(a);if(!a)return null;var b=d.K1F.K1K(a,":");if(2!=b.length)return d.Log.error("Invalid option:"+a),null;var c=this.K1B(b[0]),b=this.K1B(b[1]);return null==c||null==b||c.isComposite&&b.isComposite?(d.Log.error("Invalid option:"+a),null):
{leftAP:c,rightAP:b}},K1B:function(a){a=d.K1F.trim(a);if("("==a[0])return this.K19(a);var b=d.K1F.K1K(a,">"),a=d.K1F.trim(b[0]);b.splice(0,1);var b=b.map(function(c){return d.K1F.trim(c)}),c=null;if(d.KS.KW(a))b.splice(0,0,a),a="*";else if("]"==a[a.length-1]){var f=d.K1F.K1J(a,0,"[","]");f&&(c=this.K1A(a.substr(f.start+1,f.end-f.start-1)),a=a.substr(0,f.start))}return{description:a,pipes:b,
options:c}},K1A:function(a){for(var b={},a=d.K1F.K1K(a,";"),c=0;c<a.length;c++){var f=a[c].split(":");2!=f.length||!f[0]||!f[1]?d.Log.error("Invalid AP option:"+a[c]):b[d.K1F.trim(f[0])]=d.K1F.trim(f[1])}return b},K19:function(a){var b=d.K1F.K1J(a,0,"(",")");if(!b)return d.Log.error("Invalid composite option:"+a),null;for(var c=d.K1F.K1K(a.substr(b.start+1,b.end-b.start-1),"&"),f=[],h=0;h<c.length;h++){var i=this.K1B(c[h]);
if(null==i)return null;f.push(i)}for(b=b.end+1;">"!=a[b];){if(" "!=a[b]&&"\t"!=a[b]&&"a"!=a[b]&&"\n"!=a[b])return d.Log.error("Invalid composite option:"+a),null;b++}b++;b=d.K1F.trim(a.substr(b));return!b?(d.Log.error("Invalid composite option:"+a),null):{isComposite:!0,childrenAPs:f,nToOnePipe:b}}}})(function(){return this}());(function(g){function e(c,h,b,d){if(h&&h[b]){var e=a.K1F.getValueOnPath(null,h[b]);if(!e||"function"!=typeof e)a.Log.error("'"+h[h[b]]+"' must be a function.");else try{e.apply(c,d)}catch(j){a.Log.error("Call AP event handler '"+h[h[b]]+"' failed.",j)}}}function d(c,h,b,d){if(b.description&&("*"==b.description[0]||"!"==b.description[0])){var e=b.description,j=!1;if("!"==e[0]&&(e=a.K1F.trim(e.substr(1)),j=!0,"*"!=e[0]))return{target:d?c:h,ap:b};var g;a.K1F.K1G(e,"*LEFT")&&(g=e.substr(5),
d=!0);a.K1F.K1G(e,"*RIGHT")&&(g=e.substr(6),d=!1);""===g&&(g="*");g&&"."==g[0]&&(g=g.substr(1));if(g){j&&(g="!"+g);var e={},n;for(n in b)e[n]=b[n];e.description=g;b=e}}return{target:d?c:h,ap:b}}var a=g.Knot.K1M(),b=[],c=[];a.K3={K4:function(c,h){if(h&&"!"==h[0])return this.K5(c,h)||a.K2;for(var i=b.length-1;0<=i;i--)if(b[i].doesSupport(c,h))return b[i];return a.K2},K5:function(a,h){for(var b=
c.length-1;0<=b;b--)if(c[b].doesSupport(a,h))return c[b];return null},registerAPProvider:function(a,h){h?0>c.indexOf(a)&&c.push(a):0>b.indexOf(a)&&b.push(a)},unregisterAPProvider:function(a,h){h?0<=c.indexOf(a)&&c.splice(b.indexOf(a),1):0<=b.indexOf(a)&&b.splice(b.indexOf(a),1)},K8:{},K9:function(c,h){this.KD(c,h);var b=h.provider.getValue(c,h.description,h.options);try{if(h.pipes){for(var d=0;d<h.pipes.length;d++){var e=a.K1F.getValueOnPath(g,h.pipes[d]);
"function"!=typeof e&&a.Log.error("Pipe must be a function. pipe name:"+h.pipes[d]);b=e.apply(c,[b])}h.errorAPProvider&&h.errorAPProvider.setValue(c,"!"+h.description,void 0)}}catch(j){return h.errorAPProvider&&h.errorAPProvider.setValue(c,"!"+h.description,j),this.K8}return b},KA:function(c,a,b){if(!a.KB){a.KB=!0;try{this.KD(c,a),a.provider.setValue(c,a.description,b,a.options),e(c,a.options,"@set",[a.description,b])}finally{delete a.KB}}},
KC:function(c,b,d,e,k){if(d&&d.knotEvent&&d.knotEvent["@change"])for(var j=0;j<d.knotEvent["@change"].length;j++)try{a.K1F.getValueOnPath(null,d.knotEvent["@change"][j].substr(1))(c,b,d,e,k)}catch(g){a.Log.error("Call knot event 'change' handler failed.",g)}a.Debugger.knotChanged(c,b,d,e,k)},KD:function(c,a){a.provider||(a.provider=this.K4(c,a.description),a.errorAPProvider=this.K5(c,a.description))},monitor:function(c,b,d,l,k){this.KD(c,
b);this.KD(d,l);b.provider.doesSupportMonitoring(c,b.description)&&(b.changedCallback=function(){if(!l.KB){var j=a.K3.K9(c,b);if(j!=a.K3.K8){k.leftAP==b?a.K3.KC(c,d,k,j,!0):a.K3.KC(d,c,k,j,!1);b.KB=!0;try{a.K3.KA(d,l,j)}finally{delete b.KB}e(c,b.options,"@change",arguments)}}},b.provider.monitor(c,
b.description,b.changedCallback,b.options))},stopMonitoring:function(c,a){this.KD(c,a);a.provider.doesSupportMonitoring(c,a.description)&&a.changedCallback&&(a.provider.stopMonitoring(c,a.description,a.changedCallback,a.options),delete a.changedCallback)},KE:function(c,b,d,l,k){var j,o,n,m;c.isComposite?(j=c,o=b,n=d,m=l):(j=d,o=l,n=c,m=b);for(c=0;c<j.childrenAPs.length;c++)j.childrenAPs[c].provider=a.K3.K4(o,j.childrenAPs[c].description);m.provider=
a.K3.K4(m,n.description);j.changedCallback=function(){for(var c=[],f=0;f<j.childrenAPs.length;f++){var d=a.K3.K9(o,j.childrenAPs[f]);if(d==this.K8)return;c.push(d)}f=a.K1F.getValueOnPath(g,j.nToOnePipe);typeof f!="function"&&a.Log.error("Pipe must be a function. pipe name:"+j.nToOnePipe);c=f.apply(j,[c]);a.K3.KC(b,l,k,c,m==l);a.K3.KA(m,n,c);e(m,n,"@change",[b,l,
k])};for(c=0;c<j.childrenAPs.length;c++)j.childrenAPs[c].provider.doesSupportMonitoring(o,j.childrenAPs[c].description)&&j.childrenAPs[c].provider.monitor(o,j.childrenAPs[c].description,j.changedCallback,j.childrenAPs[c].options);j.changedCallback()},KF:function(c,b,i){var e=d(c,b,i.leftAP,!0),k=d(c,b,i.rightAP,!1),c=e.target,b=k.target,e=e.ap,k=k.ap;if(e.isComposite||k.isComposite)this.KE(e,c,k,b,i);else{this.KD(c,e);this.KD(b,k);var j=this.K9(b,
k);if(j==this.K8)return;this.KC(c,b,i,j,!1);this.KA(c,e,j);this.monitor(c,e,b,k,i);this.monitor(b,k,c,e,i)}a.Debugger.knotTied(c,b,i)},KG:function(c,b,i){var e=d(c,b,i.leftAP,!0),k=d(c,b,i.rightAP,!1),c=e.target,b=k.target,e=e.ap,k=k.ap;if(e.isComposite||k.isComposite){if(e.isComposite?(k=e,e=c):e=b,k.changedCallback)for(var j=0;j<k.childrenAPs.length;j++)k.childrenAPs[j].provider.doesSupportMonitoring(e,k.childrenAPs[j].description)&&k.childrenAPs[j].provider.stopMonitoring(e,
k.childrenAPs[j].description,k.changedCallback,k.childrenAPs[j].options)}else this.stopMonitoring(c,e,e.options),delete e.changedCallback,this.stopMonitoring(b,k,k.options);delete k.changedCallback;a.Debugger.knotUntied(c,b,i)},KH:function(c){c.changedCallback&&c.changedCallback()}};a.K2={doesSupport:function(){return!0},getValue:function(c,b){var d=!1;"@"==b[0]&&(d=!0,b=b.substr(1));var e=a.K1F.getValueOnPath(c,b);if("function"==typeof e&&!d)try{return e.apply(c)}catch(k){a.Log.error("Call get value function failed.",
k)}else return e},setValue:function(c,b,d){a.K1F.setValueOnPath(c,b,d)},doesSupportMonitoring:function(c){return"object"!=typeof c&&"array"!=typeof c?!1:!0},monitor:function(c,b,d){b&&"/"==b[0]&&(c=g,b=b.substr(1));c&&a.KM.monitor(c,b,d)},stopMonitoring:function(c,b,d){b&&"/"==b[0]&&(c=g,b=b.substr(1));c&&a.KM.stopMonitoring(c,b,d)}}})(function(){return this}());(function(g){function e(b){c.Kh.K15(b);b.parentNode.removeChild(b);c.Debugger.nodeRemoved(b)}function d(b,a,d){if(!d||!d.template)c.Log.error("No valid template is specified for 'content' access point. current node:"+c.KX.KY(b));else{var f=b.childNodes[0];if(f){if(!(f.__knot&&f.__knot.dataContext==a))if(null===a||"undefined"===typeof a)e(f);else{if(c.Kh.K10(d.template)){if(e(f),f=c.Kh.createFromTemplateAndUpdateData(d.template,
a,b))b.appendChild(f,a),c.Debugger.nodeAdded(j)}else c.Kh.K13(f,a);f.__knot&&(f.__knot={});f.__knot.dataContext=a}}else if(!(null===a||"undefined"===typeof a)){var j=c.Kh.createFromTemplateAndUpdateData(d.template,a,b);j&&(b.appendChild(j,a),c.Debugger.nodeAdded(j))}}}function a(b,a,d,f,j){a||(a=[]);for(var g=0;g<a.length;g++){var n;a:{for(var m=g;m<b.children.length;m++)if(b.children[m].__knot&&b.children[m].__knot.dataContext==a[g]){n=b.children[m];break a}n=
null}if(n){if(Array.prototype.indexOf.call(b.children,n)!=g){b.removeChild(n);var m=b,p=g;m.children.length==p?m.appendChild(n):m.insertBefore(n,m.children[p])}}else{var q=c.Kh.createFromTemplateAndUpdateData(d,a[g],b);q&&(m=b,n=q,p=g,m.children.length==p?m.appendChild(n):m.insertBefore(n,m.children[p]),c.Debugger.nodeAdded(q),f&&f.apply(b,[q]))}}for(g=b.children.length-1;g>=a.length;g--)e(b.children[g]),j&&j.apply(b,[q])}function b(b,d,f){!f||!f.template?c.Log.error("No valid template is specified for 'foreach' access point. current node:"+
c.KX.KY(b)):a(b,d,f.template,c.K1F.getValueOnPath(b,f["@added"]),c.K1F.getValueOnPath(b,f["@removed"]))}var c=g.Knot.K1M(),f=[];f["input.value"]="change";f["textarea.value"]="change";f["input.checked"]="change";f["select.selectedindex"]="change";f["select.value"]="change";c.KX={KY:function(c){var b=c.tagName;c.id?b+="[#"+c.id+"]":c.className&&(b+="["+c.className.split(" ").filter(function(c){return c.trim()!=""}).map(function(c){return"."+
c}).join(" ")+"]");return b},KZ:function(b){b=c.K1F.K1K(b,".");return c.K1F.trim(b[0])},Ka:function(b){b=c.K1F.K1K(b,".");if(1<b.length)return b.slice(1).join(".")},Kb:function(b,a){return!b?void 0:c.K1F.getValueOnPath(b,a)},Kc:function(b){var a={apName:b,options:{}},d=c.K1F.K1J(b,0,"[","]");if(d){a.apName=c.K1F.trim(b.substr(0,d.start));b=b.substr(d.start+
1,d.end-d.start-1);b=b.split(";");for(d=0;d<b.length;d++){var f=b[d].split(":");2!=f.length?c.Log.error("Invalid options:"+b[d]):a.options[c.K1F.trim(f[0])]=c.K1F.trim(f[1])}}else a.apName=b;return a},Kd:function(b){if(0<b.indexOf("(")){var a=c.K1F.K1J(b,0,"(",")");if(a)try{var d=b.substr(a.start+1,a.end-a.start-1);return document.querySelector(d)}catch(f){c.Log.error("Query selector failed.",f)}else c.Log.error("Unknown selector:"+b)}else return document.querySelector(b)}};
c.Kf={doesSupport:function(b,c){return"#"==c[0]?!0:"!"==c[0]?!1:b instanceof HTMLElement?!0:!1},getValue:function(b,a){if("@"!=a[0]&&("#"==a[0]&&(b=c.KX.Kd(c.KX.KZ(a)),a=c.KX.Ka(a)),!c.K1F.K1G(a,"content")&&!c.K1F.K1G(a,"foreach")))return c.KX.Kb(b,a)},setValue:function(a,f,e,g){"@"==f[0]?("function"!=typeof e&&c.Log.error("Event listener must be a function!"),
a&&a.addEventListener(f.substr(1),function(b){e.apply(a.__knot.dataContext,[b,a])})):("#"==f[0]&&(a=c.KX.Kd(c.KX.KZ(f)),f=c.KX.Ka(f)),c.K1F.K1G(f,"content"))?d(a,e,g):c.K1F.K1G(f,"foreach")?b(a,e,g):("undefined"==typeof e&&(e=""),c.K1F.setValueOnPath(a,f,e))},doesSupportMonitoring:function(b,a){"#"==a[0]&&(b=c.KX.Kd(c.KX.KZ(a)),a=c.KX.Ka(a));
if(!b)return!1;var d=b.tagName.toLowerCase()+"."+a.toLowerCase();return f[d]?!0:!1},monitor:function(b,a,d,e){"#"==a[0]&&(b=c.KX.Kd(c.KX.KZ(a)),a=c.KX.Ka(a));for(var a=b.tagName.toLowerCase()+"."+a.toLowerCase(),a=f[a].split(","),g=0;g<a.length;g++)b.addEventListener(a[g],d);("input"==b.tagName.toLowerCase()||"textarea"==b.tagName.toLowerCase())&&(e&&(1==e.immediately||"true"==e.immediately.toLowerCase()))&&b.addEventListener("keyup",
d)},stopMonitoring:function(b,a,d,e){"#"==a[0]&&(b=c.KX.Kd(c.KX.KZ(a)),a=c.KX.Ka(a));for(var a=b.tagName.toLowerCase()+"."+a.toLowerCase(),a=f[a].split(","),g=0;g<a.length;g++)b.removeEventListener(a[g],d);("input"==b.tagName.toLowerCase()||"textarea"==b.tagName.toLowerCase())&&(e&&(1==e.immediately||"true"==e.immediately.toLowerCase()))&&b.removeEventListener("keyup",d)},syncItems:a};c.K3.registerAPProvider(c.Kf);
c.Kg={doesSupport:function(b,a){a&&("!"==a[0]&&(a=a.substr(1)),"#"==a[0]&&(b=c.KX.Kd(c.KX.KZ(a))));return b instanceof HTMLElement},getValue:function(b,a){if("!"==a[0]&&(a=a.substr(1),"#"==a[0]&&(b=c.KX.Kd(c.KX.KZ(a)),a=c.KX.Ka(a)),b))return!b.__knot_errorStatusInfo||!b.__knot_errorStatusInfo[a]?null:b.__knot_errorStatusInfo[a].currentStatus},setValue:function(b,
a,d){if("!"==a[0]&&(a=a.substr(1),"#"==a[0]&&(b=c.KX.Kd(c.KX.KZ(a)),a=c.KX.Ka(a)),b&&(d||b.__knot_errorStatusInfo&&b.__knot_errorStatusInfo[a]&&b.__knot_errorStatusInfo[a].K1O)))if(b.__knot_errorStatusInfo||(b.__knot_errorStatusInfo={}),b.__knot_errorStatusInfo[a]||(b.__knot_errorStatusInfo[a]={}),b.__knot_errorStatusInfo[a].currentStatus=d,b.__knot_errorStatusInfo[a].K1O)for(var f=b.__knot_errorStatusInfo[a].K1O,
e=0;e<f.length;e++)try{f[e].apply(b,[a,d])}catch(g){c.Log.warning("Call error status changed callback failed.",g)}},doesSupportMonitoring:function(b,a){return"!"==a[0]?!0:!1},monitor:function(b,a,d){"!"==a[0]&&(a=a.substr(1),"#"==a[0]&&(b=c.KX.Kd(c.KX.KZ(a)),a=c.KX.Ka(a)),b.__knot_errorStatusInfo||(b.__knot_errorStatusInfo={}),b.__knot_errorStatusInfo[a]||(b.__knot_errorStatusInfo[a]={}),b.__knot_errorStatusInfo[a].K1O||
(b.__knot_errorStatusInfo[a].K1O=[]),b.__knot_errorStatusInfo[a].K1O.push(d))},stopMonitoring:function(b,a,d){"#"==a[1]&&(b=c.KX.Kd(c.KX.KZ(a.substr(1))),a=c.KX.Ka(a.substr(1)));b.__knot_errorStatusInfo&&(b.__knot_errorStatusInfo[a]&&b.__knot_errorStatusInfo[a].K1O)&&(d=b.__knot_errorStatusInfo[a].K1O.indexOf(d),0<=d&&b.__knot_errorStatusInfo[a].K1O.splice(d,
1))},getErrorStatusInformation:function(b,a){if(b.__knot_errorStatusInfo)for(var c in b.__knot_errorStatusInfo)b.__knot_errorStatusInfo[c]&&b.__knot_errorStatusInfo[c].currentStatus&&a.push({node:b,K1P:c,error:b.__knot_errorStatusInfo[c].currentStatus});for(c=0;c<b.children.length;c++)this.getErrorStatusInformation(b.children[c],a)}};c.K3.registerAPProvider(c.Kg,!0)})(function(){return this}());(function(g){function e(b){if(!b||""==b)return null;for(var c;0<=(c=b.indexOf("/*"));){var d=b.indexOf("*/",c);if(0>d)throw Error("Can't find close mark for comment.");b=b.substr(0,c)+b.substr(d+2)}b=b.split("\n");c="";for(d=0;d<b.length;d++)for(var e=b[d].split("\r"),g=0;g<e.length;g++)"//"!=a.K1F.trim(e[g]).substr(0,2)&&(c+=e[g]);return c}function d(b){if(!b)return null;for(var a=0;a<b.length;a++)if("dataContext"==b[a].leftAP.description)return b[a];return null}var a=g.Knot.K1M();
a.Kh={Ki:{},Kj:[],Kk:{},Kl:function(){for(var b=new a.Deferred,c=g.document.querySelectorAll('script[type="text/cbs"]'),d=this,h=0,i=0;i<c.length;i++)if(c[i].src)h++,function(){var g=c[i].src,j=a.K1F.K1I();j.onreadystatechange=function(){if(4==j.readyState)if(200==j.status)try{var c=e(j.responseText);d.Km(c);h--;if(0==h)try{b.resolve()}catch(i){a.Log.error("Initialize failed.  message:"+i.message,i)}}catch(l){a.Log.error("Load CBS script error. url:"+
g+" message:"+l.message,l),b.reject(l)}else a.Log.error("Load CBS script error. url:"+g+" message:"+j.statusText),b.reject(Error("Load CBS script error. url:"+g+" message:"+j.statusText))};j.open("GET",g,!0);j.send()}();else try{this.Km(e(c[i].textContent))}catch(l){b.reject(l)}0==h&&b.resolve();return b},Km:function(b){b=a.K1F.trim(b);if(a.K1F.K1G(b,"$private")){var c={CBS:{}},b=b.substr(8),b=this.Kn(c,b);this.Ko(c.CBS,b);this.Kj.push(c)}else this.Ko(this.Ki,
b)},Kn:function(b,c){b.HTML||(b.HTML="");for(var d=0,e="",g=a.K1F.K1J(c,d,"<<{{","}}>>");null!=g;)e+=c.substr(d,g.start-d),b.HTML+=c.substr(g.start+4,g.end-g.start-4),d=g.end+4,g=a.K1F.K1J(c,d,"<<{{","}}>>");d<c.length&&(e+=c.substr(d));return e},Ko:function(b,c){for(var d=0,e=a.K1F.K1J(c,d,"{","}");null!=e;){d=c.substr(d,e.start-d);d=a.K1F.trim(d);b[d]||(b[d]=[]);for(var g=c.substr(e.start+1,e.end-e.start-1),g=a.K18.K1E(g),
g=a.K1F.K1K(g,";"),l=0;l<g.length;l++){var k=a.K1F.trim(g[l]);0>b[d].indexOf(k)&&b[d].push(k)}d=e.end+1;e=a.K1F.K1J(c,d,"{","}")}},Kp:[],Kq:function(b){var c=null;b.__knot&&b.__knot.cbsOptions&&(c=b.__knot.cbsOptions,delete b.__knot.cbsOptions);if(b.attributes.binding&&b.attributes.binding.value){c||(c=[]);var d=b.attributes.binding.value,d=a.K18.K1E(d),d=d.split(";").map(function(b){return a.K1F.trim(b)}),
c=c.concat(d)}if(c)for(d=0;d<c.length;d++){b.__knot||(b.__knot={options:[]});var e=a.K18.parse(c[d]);0!=e.length&&(b.__knot.options.push(e[0]),this.Kr(e[0].leftAP)&&0>this.Kp.indexOf(b)&&this.Kp.push(b))}for(c=0;c<b.children.length;c++)this.Kq(b.children[c])},Kr:function(b){return"foreach"==b.description||"content"==b.description},Ks:function(){if(0<this.Kj.length){for(var b="",a=0;a<
this.Kj.length;a++)b+=this.Kj[a].HTML;this.K1N=document.createElement("DIV");this.K1N.innerHTML=b;for(a=0;a<this.Kj.length;a++)this.Kt(this.K1N,this.Kj[a].CBS),this.Kq(this.K1N)}this.Kt(document,this.Ki);this.Kq(document.body)},Kt:function(b,c){for(var d in c){var e=b.querySelectorAll(d);0==e.length&&a.Log.warning("There is no element selected with selector:"+
d);for(var g=0;g<e.length;g++){var l=c[d].slice(0);e[g].__knot||(e[g].__knot={options:[]});e[g].__knot.cbsOptions&&(l=e[g].__knot.cbsOptions.concat(l));e[g].__knot.cbsOptions=l}}},Ku:0,Kv:function(){var b=[];this.K1N&&(b=b.concat(this.Kw(this.K1N)));for(var b=b.concat(this.Kw(document)),c=0;c<this.Kp.length;c++)for(var d=0;d<this.Kp[c].__knot.options.length;d++)this.Kr(this.Kp[c].__knot.options[d].leftAP)&&
this.Kx(this.Kp[c],this.Kp[c].__knot.options[d].leftAP),this.Kr(this.Kp[c].__knot.options[d].rightAP)&&this.Kx(this.Kp[c],this.Kp[c].__knot.options[d].rightAP);for(c=this.Kp.length=0;c<b.length;c++)delete b[c].__knot_template_id,b[c].removeAttribute("knot-template"),b[c].removeAttribute("knot-template-id"),b[c].parentNode.removeChild(b[c]);this.K1N&&
(0<this.K1N.children.length&&a.Log.warning("Useless HTML is detected in private scope."+this.K1N.innerHTML),this.K1N=null)},Kw:function(b){for(var b=b.querySelectorAll("*[knot-template], *[knot-template-id]"),a=0;a<b.length;a++){var d;d=b[a].getAttribute("knot-template-id")?b[a].getAttribute("knot-template-id"):"knot_template_"+this.Ku++;this.Kk[d]=b[a];b[a].__knot_template_id=d}return Array.prototype.slice.apply(b,[0])},
Kx:function(b,c){var d;if(!c.options||!c.options.template){if(d=b.children[0],1<b.children.length&&a.Log.warning("More than one child is found within '"+a.KX.KY(b)+'", only the first will be taken as template and the reset will be removed.'),!d){a.Log.error("Can't find template within'"+a.KX.KY(b)+"'");return}}else{var e=c.options.template;if("@"==e[0])return;d=this.Kk[e];if(!d){a.Log.error("Can't find template with selector'"+
e+"'");return}}d.__knot_template_id||a.Log.error("The template node must be marked with 'knot-template'. Current node:'"+a.KX.KY(b)+"'");c.options||(c.options={});c.options.template=d.__knot_template_id},Ky:function(b,a){b.__knot?a.__knot=JSON.parse(JSON.stringify(b.__knot)):delete a.__knot;for(var d=0;d<b.children.length;d++)this.Ky(b.children[d],a.children[d])},Kz:function(b){var a=b.cloneNode(!0);this.Ky(b,a);return a},
K10:function(b){return!this.Kk[b]},createFromTemplate:function(b){if(this.Kk[b])return this.Kz(this.Kk[b]);a.Log.error("Failed find template. id:"+b)},createFromTemplateAndUpdateData:function(b,c,d){if("function"==typeof b||!this.Kk[b]){var e;e="function"==typeof b?b:a.K1F.getValueOnPath(c,b);if("function"==typeof e){if(d=e.apply(d,[c]),!d){a.Log.error("Template function must return a HTML element. template:"+b);return}}else{a.Log.error("Unknown template:"+
b);return}}else{d=this.createFromTemplate(b);if(!d)return;this.K13(d,c)}d.__knot?d.__knot.dataContext=c:d.__knot={dataContext:c};return d},K11:function(b){if(b.__knot&&b.__knot.options)for(var c=0;c<b.__knot.options.length;c++)"dataContext"!=b.__knot.options[c].leftAP.description&&a.K3.KG(b,b.__knot.dataContext,b.__knot.options[c])},K12:function(b){if(b.__knot&&b.__knot.options)for(var c=0;c<b.__knot.options.length;c++)"dataContext"!=b.__knot.options[c].leftAP.description&&
a.K3.KF(b,b.__knot.dataContext,b.__knot.options[c])},K13:function(b,c){if(b.__knot){var f=d(b.__knot.options),e=c;if(f){e=a.K3.K9(c,f.rightAP);if(e==a.K3.K8){a.Log.error("Get context data failed. node:"+a.KX.KY(b));return}if(f.hasTiedUpKnot&&e===b.__knot.dataContext)return;(f.data||"/"==f.rightAP.description[0])&&f.changedCallback&&f.rightAP.provider.stopMonitoring(f.data,
f.rightAP.description,f.changedCallback,f.rightAP.options);f.data=c;f.data||"/"==f.rightAP.description[0]?(f.changedCallback=function(){a.Kh.K13(b,c)},f.rightAP.provider.monitor(f.data,f.rightAP.description,f.changedCallback,f.rightAP.options)):f.changedCallback=null;f.hasTiedUpKnot=!0}this.K11(b);a.K3.KC(b,c,f,e,!1);for(f=0;f<b.childNodes.length;f++)this.K13(b.childNodes[f],e);b.__knot.dataContext=e;this.K12(b)}else for(f=
0;f<b.childNodes.length;f++)this.K13(b.childNodes[f],c)},K14:function(b){for(;b;){if(b.__knot)return b.__knot.dataContext;b=b.parentNode}},K15:function(b){if(b.__knot){var a=d(b.__knot.options);a&&((a.data||"/"==a.rightAP.description[0])&&a.changedCallback&&a.rightAP.provider.stopMonitoring(a.data,a.rightAP.description,a.changedCallback,a.rightAP.options),a.data=null,a.changedCallback=null,a.hasTiedUpKnot=!1);this.K11(b);delete b.__knot.dataContext}for(a=
0;a<b.childNodes.length;a++)this.K15(b.childNodes[a])},bind:function(){this.K13(document.body,null)},clear:function(){this.K15(document.body)},K16:function(a,c){a.__knot||(a.__knot={});a.__knot.dataContext=c},K1L:function(a){if(a.__knot)return a.__knot.dataContext},K17:function(b){if(b.__knot&&b.__knot.options)for(var c=0;c<b.__knot.options.length;c++)"dataContext"!=b.__knot.options[c].leftAP.description&&!(b.__knot.options[c].leftAP.description&&
"!"==b.__knot.options[c].leftAP.description[0])&&a.K3.KH(b.__knot.options[c].leftAP);for(c=0;c<b.children.length;c++)this.K17(b.children[c])}}})(function(){return this}());(function(){function g(d,a,b,c){c=e.K18.parse(a+":"+c);0<c.length?(e.K3.KF(d,b,c[0]),d.__knot.options||(d.__knot.options=[]),d.__knot.options.push(c[0])):d[a]=b;return c}var e=Knot.K1M();e.K3.registerAPProvider({doesSupport:function(d,a){"#"==a[0]&&(d=document.querySelector(e.KX.KZ(a)),a=e.KX.Ka(a));return d instanceof HTMLElement&&("select"==d.tagName.toLowerCase()&&(e.K1F.K1G(a,
"options")||"selectedData"==a)||"class"==a)?!0:!1},getValue:function(d,a){"#"==a[0]&&(d=document.querySelector(e.KX.KZ(a)),a=e.KX.Ka(a));if("selectedData"==a){var b=d.options[d.selectedIndex];if(b)return b.__knot?b.__knot.dataContext:void 0}else{if("class"==a)return d.className;if(e.K1F.K1G(a,"options"))return d.options}},setValue:function(d,a,b,c){"#"==a[0]&&(d=document.querySelector(e.KX.KZ(a)),
a=e.KX.Ka(a));if("selectedData"==a){for(var f=0;f<d.options.length;f++)if(d.options[f].__knot&&d.options[f].__knot.dataContext==b){d.selectedIndex=f;return}d.selectedIndex=-1}if("class"==a)if(b){c=d.className.split(" ");b=b.split(" ");for(f=0;f<b.length;f++)a=b[f],"-"==a[0]?(a=a.substr(1).trim(),0<=c.indexOf(a)&&c.splice(c.indexOf(a),1)):("+"==a[0]&&(a=a.substr(1).trim()),0>c.indexOf(a)&&c.push(a));d.className=c.join(" ")}else"-"==b&&(d.className="");else if(e.K1F.K1G(a,
"options")){c||(c={});b||(b=[]);for(f=0;f<b.length;f++){a:{for(var a=d.options,h=b[f],i=f;i<a.length;i++)if(e.Kh.K1L(a[i])==h){a=a[i];break a}a=null}a?d.options[f].indexOf(a)!=f&&(d.options.remove(d.options[f].indexOf(a)),d.options.add(a,f)):(a=document.createElement("option"),e.Kh.K16(a,b[f]),b[f]&&(c.displayMember?g(a,"text",b[f],c.displayMember):a.text=b[f],c.valueMember?g(a,"value",b[f],c.valueMember):a.value=b[f]),d.options.add(a,f))}for(f=
d.options.length-1;f>=b.length;f--){c=d.options[f];if(c.__knot&&c.__knot.options){for(a=0;a<c.__knot.options.length;a++)e.K3.KG(c,c.__knot.dataContext,c.__knot.options[a]);delete c.__knot.dataContext}d.options.remove(f)}}},doesSupportMonitoring:function(d,a){"#"==a[0]&&(document.querySelector(e.KX.KZ(a)),a=e.KX.Ka(a));return"selectedData"==a?!0:!1},monitor:function(d,a,b){"#"==a[0]&&(d=document.querySelector(e.KX.KZ(a)),
a=e.KX.Ka(a));"selectedData"==a&&d.addEventListener("change",b)},stopMonitoring:function(d,a,b){"#"==a[0]&&(d=document.querySelector(e.KX.KZ(a)),a=e.KX.Ka(a));"selectedData"==a&&d.removeEventListener("change",b)}})})(function(){return this}());(function(g){function e(){a&&(b?a(!1,b):g.Knot.isReady&&a(!0))}var d=g.Knot.K1M();delete g.Knot.K1M;g.Knot.Advanced={registerAPProvider:function(a){return d.K3.registerAPProvider(a)},registerLog:function(a){d.Log.log=a},registerDebugger:function(a){d.Debugger=a},synchronizeItems:function(a,b,e,g,l){d.Kf.syncItems(a,b,e,g,l)},createFromTemplate:function(a,b,e){return d.Kh.createFromTemplateAndUpdateData(a,b,e)},getValueOnPath:function(a,
b){return d.K1F.getValueOnPath(a,b)},registerNamedGlobalSymbol:function(a,b){return d.KS.KT(a,b)}};g.Knot.getErrorStatusInformation=function(a){a||(a=document.body);d.Kh.K17(a);var b=[];d.Kg.getErrorStatusInformation(a,b);return b};g.Knot.notifyObjectChanged=function(a,b,e,g){d.KM.notifyDataChanged(a,b,e,g)};g.Knot.monitorObject=function(a,b,e){d.KM.monitorObject(a,b,e)};g.Knot.stopMonitoringObject=
function(a,b,e){d.KM.stopMonitoring(a,b,e)};g.Knot.getPropertiesChangeRecords=function(a){return d.KM.getPropertiesChangeRecords(a)};g.Knot.clearPropertiesChangeRecords=function(a){return d.KM.clearPropertiesChangeRecords(a)};g.Knot.clear=function(){d.Kh.clear()};g.Knot.getDataContext=function(a){return d.Kh.K14(a)};g.Knot.findElementBindToData=function(a,b){for(var d=0;d<a.length;d++)if(g.Knot.getDataContext(a[d])==b)return a};
var a,b;g.Knot.ready=function(c){a=c;(g.Knot.isReady||null!=b)&&e()};g.Knot.isReady=!1;g.addEventListener("load",function(){d.Kh.Kl().done(function(){d.Kh.Ks();d.Kh.Kv();d.Kh.bind();g.Knot.isReady=!0;b=null;e()},function(a){g.Knot.isReady=!1;b=a;e()})})})(function(){return this}());
